<!doctype html>
<html>
<head>

  <script src="../../lib/perf.js"></script>

  <meta charset="utf-8">
  <title>app</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="import" href="../../polymer/polymer.html">
<!--
  <link rel="import" href="../../elements/elements.html">
  <link rel="import" href="elements/elements.html">
  <link rel="import" href="assets/icons.html">
-->
  <link rel="import" href="elements/x-item.html">

  <link rel="stylesheet" href="app.css">

  <link rel="import" href="assets/data.html">

</head>
<body fullbleed vertical layout>

  <script>console.perf();</script>

  <script>
    //Polymer.log.events = true;
  </script>    

  <x-app flex></x-app>

  <template>

    <style>
      :host {
        display: block;
      }
      #otherBars {
        margin-right: 16px;
      }
      #columns {
       margin-left: 32px;  
      }
      #leftColumn {
        width: 200px; 
        margin-right: 8px;
      }
      #selector [selected] {
        background-color: #FAF0E8 !important;
      }
      x-repeater {
        display: block;
      }
    </style>

    <!-- appbar -->
    <x-appbar></x-appbar>

    <!-- other bars -->
    <div id="otherBars">
      <x-mailbar selected:="selectedPage" on-mailbar-back="mailListAction"></x-mailbar>
      <x-composebar></x-composebar>
    </div>

    <!-- columns -->
    <div id="columns" flex horizontal layout style="overflow: hidden;">

      <!-- left column -->
      <div id="leftColumn" vertical layout>
        <x-repeater id="labels" scroll></x-repeater>
        <x-contactbar></x-contactbar>
        <x-repeater id="contacts" flex scroll></x-repeater>
      </div>

      <!-- main column -->   
      <x-pages selected:="selectedPage" flex vertical layout>
        <x-selector id="selector" selected:="selectedItem" flex scroll>
          <x-repeater id="mailList"></x-repeater>
        </x-selector>
        <div id="reader" flex>And now for something completely different...</div>
      </x-pages>

    </div>

  </template>
  <script>

    Polymer({
      name: 'x-app',
      hostAttributes: 'vertical layout',
      listeners: {
        'mailbar-back': 'mailListAction',
        'reader.click': 'mailListAction'
      },
      created: function() {
        this.mail = data.items;
        this.labels = data.items.slice(0, 10);
        this.contacts = data.items.slice(20, 35);
        this.selectedPage = 0;
        this.render();
      },
      selectedItemChanged: function(value, old) {
        this.selectedPage = 1;
      },
      mailListAction: function(e) {
        this.selectedPage = 0;
      },
      render: function() {
        this.renderItems(this.$.mailList, 'x-item', this.mail);
        this.renderItems(this.$.labels, 'x-item', this.labels);
        this.renderItems(this.$.contacts, 'x-item', this.contacts);
      },
      renderItems: function(parent, tag, items) {
        parent.textContent = '';
        var frag = document.createDocumentFragment();
        items.forEach(function(i) {
          var e = document.createElement(tag);
          e.item = i;
          frag.appendChild(e);
        }, this);
        parent.appendChild(frag);
      }
    });

  </script>

  <script>console.perfEnd();</script>

</body>
</html>
